# egg-examples

在 egg 框架中实现一些基础操作，便于日后在项目中集成

## 业务设计
1. 保存用户
    1. 保存redis
    2. 保存mysql
2. 获取用户信息和用户操作记录
    1. redis 获取
    2. mysql 获取
3. 保存用户操作记录
    1. 添加消息队列。任务异步处理，提高接口吞吐量
    2. 定时保存到 redis 和 mysql 中 。统一处理减少数据库的连接次数

## 已经完成的功能
1. 中间件
    1. 记录整个请求链路
    2. 统一封装返回结果
2. 使用 orm-sequelize 操作 mysql
    1. 数据库连接中的基础属性设置
    2. 表模型创建
    3. 数据库表同步
    4. 创建表间关系，使用关联查询
        1. 一对一
    5. 事务操作
        1. 创建事务
        2. 设置隔离级别(未提交读，提交读，可重复读，串行化的)
        3. 事务提交和回滚
3. 使用redis数据库
    1. 字符串类型存储和读取
    2. 使用setnx实现单机锁

## 备注
1. 添加vscode -- egg 插件，主要使用以下功能
    1. debug:需要去除 --inspect-brk 才能本地调试
    2. service , controller 代码模板
2. npx sequelize 指令最好不好使用，缺点如下：
    1. 每个表还需要单独编写，不能直接使用model文件创建
    2. 表会出现无法同步的情况
3. redis 锁需要注意如下内容：
    1. 保证redis操作的原子性
    2. 解决业务未完成，但是锁过期，被其他客户端获取，从而造成互斥锁
    3. lock的时候如果发现已经锁定，需要设置等待机制
    4. 锁的过期时间需要添加随机性，防止一次性锁全部失效